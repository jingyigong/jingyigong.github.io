<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>佛教日历 - 佛历在线查询</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px; /* 缩小移动端内边距 */
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 20px; /* 缩小移动端间距 */
        }

        .header h1 {
            font-size: 1.8em; /* 缩小移动端字体 */
            margin-bottom: 5px; /* 缩小移动端间距 */
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        @media (min-width: 768px) {
            body {
                padding: 20px;
            }

            .header h1 {
                font-size: 2.5em;
                margin-bottom: 10px;
            }

            .header {
                margin-bottom: 30px;
            }
        }

        .calendar-card {
            background: white;
            border-radius: 15px; /* 缩小移动端圆角 */
            padding: 15px; /* 缩小移动端内边距 */
            box-shadow: 0 10px 30px rgba(0,0,0,0.2); /* 调整移动端阴影 */
        }

        @media (min-width: 768px) {
            .calendar-card {
                border-radius: 20px;
                padding: 30px;
                box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            }
        }

        .controls {
            display: flex;
            flex-wrap: wrap; /* 允许换行适应小屏幕 */
            justify-content: center; /* 移动端居中 */
            align-items: center;
            gap: 10px; /* 缩小移动端间距 */
            margin-bottom: 15px; /* 缩小移动端间距 */
        }

        @media (min-width: 768px) {
            .controls {
                justify-content: space-between;
                gap: 15px;
                margin-bottom: 20px;
            }
        }

        .date-selector {
            display: flex;
            align-items: center;
            gap: 5px; /* 缩小移动端间距 */
            flex-wrap: wrap; /* 允许换行 */
            justify-content: center; /* 移动端居中 */
        }

        @media (min-width: 768px) {
            .date-selector {
                gap: 10px;
                justify-content: flex-start;
            }
        }

        .date-selector select {
            padding: 10px; /* 增大移动端点击区域 */
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px; /* 防止iOS缩放 */
            cursor: pointer;
            transition: all 0.3s;
            min-width: 70px; /* 移动端最小宽度 */
        }

        @media (min-width: 768px) {
            .date-selector select {
                padding: 8px 15px;
                font-size: 14px;
                min-width: auto;
            }
        }

        .date-selector select:hover {
            border-color: #667eea;
        }

        .lunar-info {
            font-size: 12px; /* 缩小移动端字体 */
            color: #666;
            text-align: center; /* 移动端居中 */
            margin-top: 10px; /* 移动端独立一行 */
            width: 100%;
        }

        @media (min-width: 768px) {
            .lunar-info {
                font-size: 14px;
                text-align: right; /* PC端靠右 */
                margin-top: 0;
                width: auto;
            }
        }

        .nav-buttons {
            display: flex;
            gap: 8px; /* 缩小移动端按钮间距 */
            flex-wrap: wrap; /* 允许换行 */
            justify-content: center; /* 移动端居中 */
        }

        @media (min-width: 768px) {
            .nav-buttons {
                gap: 10px;
                justify-content: flex-end; /* PC端靠右 */
            }
        }

        .nav-btn {
            padding: 10px 16px; /* 增大移动端按钮 */
            border: none;
            background: #667eea;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 16px; /* 防止iOS缩放 */
            min-width: 70px; /* 移动端最小宽度 */
            text-align: center;
        }

        @media (min-width: 768px) {
            .nav-btn {
                padding: 8px 16px;
                font-size: 14px;
                min-width: auto;
            }
        }

        .nav-btn:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }

        /* 日历表格响应式 */
        .calendar-wrapper {
            overflow-x: auto; /* 横向滚动 */
            margin-top: 10px;
        }

        .calendar-table {
            width: 100%;
            min-width: 600px; /* 设置最小宽度，小屏可滚动 */
            border-collapse: collapse;
        }

        .calendar-table thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .calendar-table th {
            padding: 10px 5px; /* 缩小移动端表头 */
            font-weight: 600;
            font-size: 14px; /* 缩小移动端表头字体 */
        }

        @media (min-width: 768px) {
            .calendar-table th {
                padding: 15px;
                font-size: 16px;
            }
        }

        .calendar-table td {
            padding: 6px 2px; /* 缩小移动端单元格内边距 */
            text-align: center;
            border: 1px solid #f0f0f0;
            min-height: 70px; /* 缩小移动端单元格高度 */
            vertical-align: top;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            font-size: 12px; /* 缩小移动端字体 */
        }

        @media (min-width: 768px) {
            .calendar-table td {
                padding: 10px;
                min-height: 100px;
                font-size: 14px;
            }
        }

        .calendar-table td:hover {
            background: #3a54e597;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .sunday, .saturday {
            color: #ff4757;
        }

        .solar-day {
            font-size: 16px; /* 缩小移动端数字 */
            font-weight: bold;
            margin-bottom: 3px;
        }

        @media (min-width: 768px) {
            .solar-day {
                font-size: 24px;
                margin-bottom: 5px;
            }
        }

        .lunar-day {
            font-size: 10px; /* 缩小移动端农历 */
            color: #666;
            margin-bottom: 2px;
        }

        @media (min-width: 768px) {
            .lunar-day {
                font-size: 12px;
                margin-bottom: 3px;
            }
        }

        .festival {
            font-size: 8px; /* 缩小移动端节日字体 */
            padding: 1px 3px;
            border-radius: 3px;
            margin-top: 1px;
            display: block;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        @media (min-width: 768px) {
            .festival {
                font-size: 10px;
                padding: 2px 5px;
                border-radius: 4px;
                margin-top: 2px;
            }
        }

        .solar-festival { background: #e3f2fd; color: #1976d2; }
        .lunar-festival { background: #ffebee; color: #c62828; }
        .solar-term { background: #e8f5e9; color: #2e7d32; }
        .ten-fast-day { background: #fff3e0; color: #e65100; }

        .today {
            background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%);
            color: white;
        }

        .today .solar-day {
            color: white;
        }

        .today .lunar-day {
            color: rgba(255,255,255,0.9);
        }

        .empty-cell {
            background: #fafafa;
        }

        /* 详情弹窗响应式 */
        .detail-popup {
            position: fixed;
            background: white;
            border-radius: 12px;
            padding: 15px; /* 缩小移动端内边距 */
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            z-index: 1000;
            display: none;
            width: calc(100% - 20px); /* 移动端占满宽度 */
            max-width: 90vw; /* 最大宽度限制 */
            max-height: 80vh; /* 限制最大高度 */
            overflow-y: auto; /* 允许滚动 */
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%); /* 居中 */
        }

        @media (min-width: 768px) {
            .detail-popup {
                padding: 20px;
                width: 350px; /* PC端固定宽度 */
                max-width: 400px;
                transform: none; /* PC端取消居中，由JS定位 */
            }
        }

        .detail-popup.show {
            display: block;
        }

        .detail-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 8px;
            color: #333;
        }

        .detail-content {
            font-size: 13px;
            line-height: 1.6;
            color: #666;
        }

        .detail-festivals {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid #eee;
        }

        .detail-festivals p {
            margin: 4px 0;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px; /* 缩小移动端节日描述字体 */
            line-height: 1.5;
            word-wrap: break-word;
            white-space: normal;
        }

        @media (min-width: 768px) {
            .detail-festivals p {
                margin: 5px 0;
                padding: 5px 10px;
                font-size: 12px;
            }
        }

        .info-section {
            background: #f8f9ff;
            border-radius: 12px;
            padding: 15px; /* 缩小移动端内边距 */
            margin-top: 20px; /* 缩小移动端间距 */
        }

        @media (min-width: 768px) {
            .info-section {
                padding: 20px;
                margin-top: 30px;
            }
        }

        .info-section h3 {
            color: #667eea;
            margin-bottom: 10px; /* 缩小移动端间距 */
            font-size: 16px; /* 缩小移动端字体 */
        }

        @media (min-width: 768px) {
            .info-section h3 {
                margin-bottom: 15px;
                font-size: 18px;
            }
        }

        .info-section ul {
            list-style: none;
            padding: 0;
        }

        .info-section li {
            padding: 6px 0; /* 缩小移动端间距 */
            border-bottom: 1px solid #e0e0e0;
            color: #555;
        }

        .info-section li:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- <div class="header">
            <h1>🙏 佛教日历</h1>
            <p>佛历在线查询</p>
        </div> -->

        <div class="calendar-card">
            <div class="controls">
                <div class="date-selector">
                    <span>西历</span>
                    <select id="yearSelect"></select>
                    <span>年</span>
                    <select id="monthSelect"></select>
                    <span>月</span>
                </div>
                <div class="nav-buttons">
                    <button class="nav-btn" onclick="changeMonth(-1)">上月</button>
                    <button class="nav-btn" onclick="goToday()">今天</button>
                    <button class="nav-btn" onclick="changeMonth(1)">下月</button>
                </div>
                <div class="lunar-info" id="lunarInfo"></div>
            </div>

            <div class="calendar-wrapper">
                <table class="calendar-table">
                    <thead>
                        <tr>
                            <th class="sunday">日</th>
                            <th>一</th>
                            <th>二</th>
                            <th>三</th>
                            <th>四</th>
                            <th>五</th>
                            <th class="saturday">六</th>
                        </tr>
                    </thead>
                    <tbody id="calendarBody"></tbody>
                </table>
            </div>
        </div>

        <div class="info-section">
            <h3>📅 斋日说明</h3>
            <ul>
                <li><strong>十斋日（又称准提斋）：</strong>农历每月初一、初八、十四、十五、十八、廿三、廿四、廿八、廿九、三十日</li>
                <li><strong>六斋日：</strong>若逢大月，为农历每月初八、十四、十五、廿三、廿九、三十日；若逢小月，为农历每月初八、十四、十五、廿三、廿八、廿九日</li>
                <li><strong>朔望斋：</strong>农历每月初一、十五日</li>
                <li><strong>月斋：</strong>农历每年正月、五月、九月等三个月</li>
            </ul>
        </div>

        <div class="info-section">
            <h3>ℹ️ 佛历说明</h3>
            <p style="color: #555; line-height: 1.8;">
                佛历是由佛陀涅槃时计算起。佛陀说法四十五年，八十岁涅槃，即公元前543年，五月月圆日夜半入灭。
                佛历计算的方法：将佛陀涅槃年数543年加上今年的年数，新年过后增加一年计算。
            </p>
        </div>
    </div>

    <div class="detail-popup" id="detailPopup"></div>

    <script>
        // --- 保持所有 JS 数据和函数不变 ---
        var lunarInfo = [
            0x04bd8,0x04ae0,0x0a570,0x054d5,0x0d260,0x0d950,0x16554,0x056a0,0x09ad0,0x055d2,
            0x04ae0,0x0a5b6,0x0a4d0,0x0d250,0x1d255,0x0b540,0x0d6a0,0x0ada2,0x095b0,0x14977,
            0x04970,0x0a4b0,0x0b4b5,0x06a50,0x06d40,0x1ab54,0x02b60,0x09570,0x052f2,0x04970,
            0x06566,0x0d4a0,0x0ea50,0x06e95,0x05ad0,0x02b60,0x186e3,0x092e0,0x1c8d7,0x0c950,
            0x0d4a0,0x1d8a6,0x0b550,0x056a0,0x1a5b4,0x025d0,0x092d0,0x0d2b2,0x0a950,0x0b557,
            0x06ca0,0x0b550,0x15355,0x04da0,0x0a5d0,0x14573,0x052d0,0x0a9a8,0x0e950,0x06aa0,
            0x0aea6,0x0ab50,0x04b60,0x0aae4,0x0a570,0x05260,0x0f263,0x0d950,0x05b57,0x056a0,
            0x096d0,0x04dd5,0x04ad0,0x0a4d0,0x0d4d4,0x0d250,0x0d558,0x0b540,0x0b5a0,0x195a6,
            0x095b0,0x049b0,0x0a974,0x0a4b0,0x0b27a,0x06a50,0x06d40,0x0af46,0x0ab60,0x09570,
            0x04af5,0x04970,0x064b0,0x074a3,0x0ea50,0x06b58,0x055c0,0x0ab60,0x096d5,0x092e0,
            0x0c960,0x0d954,0x0d4a0,0x0da50,0x07552,0x056a0,0x0abb7,0x025d0,0x092d0,0x0cab5,
            0x0a950,0x0b4a0,0x0baa4,0x0ad50,0x055d9,0x04ba0,0x0a5b0,0x15176,0x052b0,0x0a930,
            0x07954,0x06aa0,0x0ad50,0x05b52,0x04b60,0x0a6e6,0x0a4e0,0x0d260,0x0ea65,0x0d530,
            0x05aa0,0x076a3,0x096d0,0x04bd7,0x04ad0,0x0a4d0,0x1d0b6,0x0d250,0x0d520,0x0dd45,
            0x0b5a0,0x056d0,0x055b2,0x049b0,0x0a577,0x0a4b0,0x0aa50,0x1b255,0x06d20,0x0ada0
        ];

        var solarMonth = [31,28,31,30,31,30,31,31,30,31,30,31];
        var Gan = ["甲","乙","丙","丁","戊","己","庚","辛","壬","癸"];
        var Zhi = ["子","丑","寅","卯","辰","巳","午","未","申","酉","戌","亥"];
        var Animals = ["鼠","牛","虎","兔","龙","蛇","马","羊","猴","鸡","狗","猪"];
        var solarTerm = ["小寒","大寒","立春","雨水","惊蛰","春分","清明","谷雨","立夏","小满","芒种","夏至","小暑","大暑","立秋","处暑","白露","秋分","寒露","霜降","立冬","小雪","大雪","冬至"];
        var sTermInfo = [0,21208,42467,63836,85337,107014,128867,150921,173149,195551,218072,240693,263343,285989,308563,331033,353350,375494,397447,419210,440795,462224,483532,504758];
        var nStr1 = ['日','一','二','三','四','五','六','七','八','九','十'];
        var nStr2 = ['初','十','廿','卅'];
        var nStr3 = ["","一","二","三","四","五","六","七","八","九","十","十一","十二"];

        var sFtv = {
            "0101": "元旦",
            "0308": "妇女节",
            "0312": "植树节",
            "0501": "劳动节",
            "0601": "儿童节",
            "0928": "教师节 孔子诞辰",
            "1001": "国庆节"
        };

        var lFtv = {
            "0101": "春节，本月为斋月！弥勒菩萨圣诞，又地藏斋，天腊，玉帝校世人神气禄命，犯者削禄夺纪，又月朔，犯者夺纪，又十斋日",
            "0103": "万神都会，犯者夺纪，斗降，犯者夺纪",
            "0105": "五虚忌",
            "0106": "定光佛圣诞，又六耗忌，又雷斋日，犯者减寿",
            "0107": "上会日，犯者损寿",
            "0108": "观音斋，又五殿阎罗天子诞，犯者夺纪，又四天王巡行，又十斋日",
            "0109": "帝释天尊（玉皇大帝）圣诞，犯者夺纪",
            "0112": "净宗七祖省常法师圆寂日",
            "0113": "杨公忌",
            "0114": "三元降，犯者减寿又四天王巡行，又十斋日",
            "0115": "元宵节，三元降犯者减寿，又上元神会，犯者夺纪，又月望，犯者夺纪，又四天王巡行，又十斋日",
            "0116": "三元降犯者减寿",
            "0118": "地藏斋，又十斋日",
            "0119": "长春真人诞",
            "0121": "净宗九祖蕅益法师圆寂日",
            "0123": "三尸神奏事，又四天王巡行，又十斋日",
            "0124": "地藏斋，又十斋日",
            "0125": "月晦日犯者减寿，又天地仓开日犯者损寿，子带疾",
            "0127": "斗降犯者夺纪，又若月小则本日为十斋日",
            "0128": "地藏斋，人神在阴犯者得病，宜先一日即戒，又十斋日",
            "0129": "四天王巡行，又十斋日",
            "0130": "月晦、司命奏事犯者减寿（如月小，即戒廿九），又四天王巡行，又十斋日",
            "0201": "地藏斋，一殿秦广王诞，又月朔，犯者夺纪，又十斋日",
            "0202": "万神都会，犯者夺纪，福德土地正神诞，犯者得祸",
            "0203": "文昌帝君诞辰犯者削禄夺纪，斗降犯者夺纪",
            "0206": "东华帝君诞，雷斋日，犯者减寿",
            "0207": "观音斋",
            "0208": "释迦牟尼佛出家，三殿宋帝王诞，张大帝诞，犯者夺纪，四天王巡行，又十斋日",
            "0209": "六祖慧能圣诞，又观音斋",
            "0211": "杨公忌",
            "0214": "四天王巡行，又十斋日",
            "0215": "释迦牟尼佛涅槃，太上老君诞，又月望（即月半），犯者削禄夺纪，四天王巡行，又十斋日",
            "0217": "东方杜将军诞",
            "0218": "地藏斋，四殿五官王诞，至圣先师孔子讳辰，犯者削禄夺纪，又十斋日",
            "0219": "观世音菩萨圣诞，犯者夺纪，又观音斋",
            "0221": "普贤菩萨圣诞",
            "0223": "四天王巡行，又十斋日",
            "0224": "地藏斋，又十斋日",
            "0225": "月晦日犯者减寿",
            "0226": "净宗六祖永明法师圆寂日",
            "0227": "斗降，犯者夺纪，又若月小则本日为十斋日",
            "0228": "地藏斋，人神在阴，犯者得病，宜先一日即戒，又十斋日",
            "0229": "四天王巡行，又十斋日",
            "0230": "月晦，司命奏事，四天王巡行，犯者减寿，如月小，即戒廿九（每月同），又十斋日",
            "0301": "地藏斋，二殿楚江王诞，又月朔，犯者夺纪，又十斋日",
            "0303": "观音斋，玄天上帝诞，斗降，犯者夺纪",
            "0306": "观音斋，雷斋日，犯者减寿",
            "0308": "六殿卞城王诞，犯者夺纪，四天王巡行，又十斋日",
            "0309": "牛鬼神出，犯者产恶胎，杨公忌",
            "0312": "中央正道诞",
            "0313": "观音斋",
            "0314": "四天王巡行，又十斋日",
            "0315": "昊天上帝诞，玄坛诞，又月望，犯者夺纪，四天王巡行，又十斋日",
            "0316": "准提菩萨圣诞，犯者夺纪",
            "0318": "地藏斋，又十斋日",
            "0319": "中岳大帝诞，后土娘娘诞，三茅降",
            "0320": "天地仓开日，犯者损寿，子孙娘娘诞",
            "0323": "四天王巡行，又十斋日",
            "0324": "地藏斋，又十斋日",
            "0325": "月晦日，犯者减寿",
            "0327": "七殿泰山王诞，斗降，犯者夺纪，又若月小则本日为十斋日",
            "0328": "地藏斋，人神在阴，犯者得病，宜先一日即戒（每月同），苍颉至圣先师诞，犯者削禄夺纪，东岳大帝诞，又十斋日",
            "0329": "四天王巡行，又十斋日",
            "0330": "月晦，司命奏事，四天王巡行，犯者减寿，如月小，即戒廿九（每月同），又十斋日",
            "0401": "地藏斋，八殿都市王诞，又月朔，犯者夺纪，又十斋日",
            "0403": "斗降，犯者夺纪",
            "0404": "文殊菩萨圣诞，又万神善会，犯者失瘼夭胎",
            "0406": "雷斋日，犯者减寿",
            "0407": "南斗、北斗、西斗同降，犯者减寿，杨公忌",
            "0408": "释迦牟尼佛圣诞，犯者夺纪，又万神善会，犯者失瘼夭胎，善恶童子降，犯者血死，九殿平等王诞，四天王巡行，又十斋日",
            "0414": "净宗十一祖省庵法师圆寂日，纯阳祖师诞，犯者减寿，四天王巡行，又十斋日",
            "0415": "月望，犯者夺纪，钟离祖师诞，四天王巡行，又十斋日",
            "0416": "天地仓开日，犯者损寿",
            "0417": "十殿转轮王诞，犯者夺纪",
            "0418": "地藏斋，天地仓开日，紫微大帝诞，犯者减寿，又十斋日",
            "0420": "眼光圣母诞",
            "0422": "观音斋",
            "0423": "四天王巡行，又十斋日",
            "0424": "地藏斋，又十斋日",
            "0425": "月晦日，犯者减寿",
            "0427": "斗降，犯者夺纪，又若月小则本日为十斋日",
            "0428": "药王菩萨圣诞，又地藏斋，人神在阴，犯者得病，宜先一日即戒，又十斋日",
            "0429": "四天王巡行，又十斋日",
            "0430": "月晦，司命奏事，四天王巡行，犯者减寿，如月小，即戒廿九（每月同），又十斋日",
            "0501": "本月为斋月！地藏斋，南极长生大帝诞，又月朔，犯者夺纪，又十斋日",
            "0503": "斗降，犯者夺纪，又观音斋",
            "0505": "端午节，地腊，五帝校定生人官爵，犯者削禄夺纪，九毒日，犯者夭亡，奇祸不测",
            "0506": "九毒日，犯者夭亡，奇祸不测，雷斋日，犯者减寿",
            "0507": "九毒日，犯者夭亡，奇祸不测",
            "0508": "南方五道诞，四天王巡行，又十斋日",
            "0511": "天仓开日，犯者损寿，天下都城隍诞",
            "0512": "炳灵公诞",
            "0513": "伽蓝菩萨圣诞，关圣降，犯者削禄夺纪",
            "0514": "夜子时为天地交泰，犯者三年内夫妇俱亡，四天王巡行，又十斋日",
            "0515": "月望，九毒日，犯者夭亡，奇祸不测，四天王巡行，又十斋日",
            "0516": "九毒日，天地元气造化万物之辰，犯者三年内夫妇俱亡",
            "0517": "观音斋，九毒日，犯者夭亡，奇祸不测",
            "0518": "地藏斋，张天师诞，又十斋日",
            "0522": "孝娥神诞，犯者夺纪",
            "0523": "四天王巡行，又十斋日",
            "0524": "地藏斋，又十斋日",
            "0525": "九毒日，犯者夭亡，奇祸不测，月晦日，犯者减寿",
            "0526": "九毒日，犯者夭亡，奇祸不测",
            "0527": "九毒日，犯者夭亡，奇祸不测，斗降，犯者夺纪，又若月小则本日为十斋日",
            "0528": "地藏斋，人神在阴，犯者得病，宜先一日即戒，又十斋日",
            "0529": "四天王巡行，又十斋日",
            "0530": "月晦，司命奏事，四天王巡行，犯者减寿，如月小，即戒廿九（每月同），又十斋日",
            "0601": "地藏斋，又月朔，犯者夺纪，又十斋日",
            "0603": "韦驮菩萨圣诞，斗降，犯者夺纪，杨公忌",
            "0605": "南赡部洲转大法轮，犯者损寿",
            "0606": "天地仓开日，雷斋日，犯者损寿",
            "0608": "四天王巡行，又十斋日",
            "0610": "金粟如来诞",
            "0614": "四天王巡行，又十斋日",
            "0615": "月望，犯者夺纪，四天王巡行，又十斋日",
            "0616": "观音斋",
            "0618": "观音斋，又地藏斋，又十斋日",
            "0619": "观世音菩萨成道，又观音斋，犯者夺纪",
            "0623": "观音斋，南方火神诞，犯者遭回禄，四天王巡行，又十斋日",
            "0624": "地藏斋，雷祖诞，关帝诞，犯者削禄夺纪，又十斋日",
            "0625": "月晦日，犯者减寿",
            "0627": "斗降，犯者夺纪，又若月小则本日为十斋日",
            "0628": "地藏斋，人神在阴，犯者得病，宜先一日即戒，又十斋日",
            "0629": "四天王巡行，又十斋日",
            "0630": "月晦，司命奏事，四天王巡行，犯者减寿，如月小，即戒廿九（每月同），又十斋日",
            "0701": "地藏斋，又月朔，犯者夺纪，杨公忌，又十斋日",
            "0702": "净宗八祖莲池法师圆寂日",
            "0703": "斗降，犯者夺纪",
            "0705": "中会日，犯者损寿，一作初七",
            "0706": "雷斋日，犯者减寿",
            "0707": "道德腊，五帝校生人善恶，魁星诞，犯者削禄夺纪",
            "0708": "四天王巡行，又十斋日",
            "0709": "净宗十祖截流法师圆寂日",
            "0710": "阴毒日",
            "0712": "长真谭真人诞",
            "0713": "大势至菩萨圣诞，犯者减寿，又观音斋",
            "0714": "三元降，犯者减寿，四天王巡行，又十斋日",
            "0715": "佛欢喜日，又月望，三元降，地官校籍，犯者夺纪，四天王巡行，又十斋日",
            "0716": "三元降，犯者减寿",
            "0718": "地藏斋，西王母诞，犯者夺纪，又十斋日",
            "0719": "净宗三祖承远法师圆寂日，太岁诞，犯者夺纪",
            "0721": "普庵祖师圣诞",
            "0722": "增福财神诞，犯者削禄夺纪",
            "0723": "四天王巡行，又十斋日",
            "0724": "龙树菩萨圣诞，又地藏斋，又十斋日",
            "0725": "月晦日，犯者减寿",
            "0727": "斗降，犯者夺纪，又若月小则本日为十斋日",
            "0728": "地藏斋，人神在阴，犯者得病，宜先一日即戒（每月同），又十斋日",
            "0729": "杨公忌，四天王巡行，又十斋日",
            "0730": "地藏王菩萨圣诞，犯者夺纪，月晦，司命奏事，四天王巡行，犯者减寿，如月小，即戒廿九（每月同），又十斋日",
            "0801": "地藏斋，又月朔，犯者夺纪，许真君诞，又十斋日",
            "0803": "斗降，北斗诞，犯者夺纪，司命灶君诞，犯者遭回禄",
            "0805": "雷声大帝诞，犯者夺纪",
            "0806": "净宗初祖慧远法师圆寂日，雷斋日，犯者减寿",
            "0808": "四天王巡行，又十斋日",
            "0810": "北斗大帝诞",
            "0812": "西方五道诞",
            "0814": "四天王巡行，又十斋日",
            "0815": "中秋节，记得持斋诵戒！又月望，太明朝元，犯者暴亡，宜焚香守夜，四天王巡行，又十斋日",
            "0816": "观音斋，天曹掠刷真君降，犯者贫夭",
            "0818": "地藏斋，天人兴福之辰，宜斋戒，存想吉事，又十斋日",
            "0822": "燃灯古佛圣诞",
            "0823": "汉恒候张显王诞，四天王巡行，又十斋日",
            "0824": "地藏斋，灶君夫人诞，又十斋日",
            "0825": "月晦日，犯者减寿",
            "0827": "斗降，至圣先师孔子诞，犯者夺纪，杨公忌，又若月小则本日为十斋日",
            "0828": "地藏斋，人神在阴，犯者得病，宜先一日即戒（每月同），四天会事，又十斋日",
            "0829": "四天王巡行，又十斋日",
            "0830": "诸神考校，犯者夺算，月晦，司命奏事，四天王巡行，犯者减寿，如月小，即戒廿九（每月同），又十斋日",
            "0901": "本月为斋月！地藏斋，又月朔，犯者夺纪，南斗诞，犯者削禄夺纪，北斗九星降世（自初一至初九），犯者夺纪，此九日俱宜斋戒，又十斋日",
            "0902": "北斗九星降世（自初一至初九），犯者夺纪，此九日俱宜斋戒",
            "0903": "斗降，犯者夺纪，五瘟神诞，北斗九星降世（自初一至初九），犯者夺纪，此九日俱宜斋戒",
            "0904": "北斗九星降世（自初一至初九），犯者夺纪，此九日俱宜斋戒",
            "0905": "北斗九星降世（自初一至初九），犯者夺纪，此九日俱宜斋戒",
            "0906": "雷斋日，犯者减寿，北斗九星降世（自初一至初九），犯者夺纪，此九日俱宜斋戒",
            "0907": "北斗九星降世（自初一至初九），犯者夺纪，此九日俱宜斋戒",
            "0908": "四天王巡行，北斗九星降世（自初一至初九），犯者夺纪，此九日俱宜斋戒，又十斋日",
            "0909": "重阳节，斗母诞，犯者削禄夺纪，酆都大帝诞，玄天上帝飞升，北斗九星降世（自初一至初九），犯者夺纪，此九日俱宜斋戒",
            "0910": "斗母降，犯者夺纪",
            "0911": "宜戒",
            "0913": "孟婆尊神诞",
            "0914": "四天王巡行，又十斋日",
            "0915": "月望，犯者夺纪，四天王巡行，又十斋日",
            "0917": "金龙四大王诞，犯者遭水厄",
            "0918": "地藏斋，又十斋日",
            "0919": "观世音菩萨出家，日宫月宫会合，犯者减寿，又观音斋",
            "0923": "观音斋，四天王巡行，又十斋日",
            "0924": "地藏斋，又十斋日",
            "0925": "月晦日，犯者减寿，杨公忌",
            "0927": "斗降，犯者夺纪，又若月小则本日为十斋日",
            "0928": "地藏斋，人神在阴，犯者得病，宜先一日即戒，又十斋日",
            "0929": "四天王巡行，又十斋日",
            "0930": "药师佛圣诞，犯者危疾，月晦，司命奏事，四天王巡行，犯者减寿，如月小，即戒廿九（每月同），又十斋日",
            "1001": "地藏斋，又月朔，民岁腊，犯者夺纪，四天王降，犯者一年内死，又十斋日",
            "1002": "观音斋",
            "1003": "净宗五祖少康法师圆寂日，斗降，犯者夺纪，三茅诞",
            "1005": "达摩祖师诞辰，下会日，犯者损寿",
            "1006": "雷斋日，犯者减寿，天曹考察，犯者夺纪",
            "1008": "大忌色欲，四天王巡行，又十斋日",
            "1010": "四天王降，犯者一年内死",
            "1011": "宜戒",
            "1014": "三元降，犯者减寿，四天王巡行，又十斋日",
            "1015": "月望，三元降，下元水府校籍，犯者夺纪，四天王巡行，又十斋日",
            "1016": "三元降，犯者减寿",
            "1018": "地藏斋，又十斋日",
            "1023": "四天王巡行，杨公忌，又十斋日",
            "1024": "地藏斋，又十斋日",
            "1025": "月晦日，犯者减寿",
            "1027": "斗降，犯者夺纪，北极紫微大帝降，又若月小则本日为十斋日",
            "1028": "地藏斋，人神在阴，犯者得病，宜先一日即戒 ，又十斋日",
            "1029": "四天王巡行，又十斋日",
            "1030": "月晦，司命奏事，四天王巡行，犯者减寿，如月小，即戒廿九（每月同），又十斋日",
            "1101": "地藏斋，又月朔，犯者夺纪，又十斋日",
            "1103": "斗降，犯者夺纪",
            "1104": "净宗十三祖印光法师圆寂日，又至圣先师孔子诞，犯者削禄夺纪",
            "1106": "雷斋日，犯者减寿，西岳大帝诞",
            "1108": "四天王巡行，又十斋日",
            "1111": "天地仓开日，太乙救苦天尊诞，犯者夺纪",
            "1114": "四天王巡行，又十斋日",
            "1115": "月望，上半夜犯男死下半夜犯女死，四天王巡行，又十斋日",
            "1117": "阿弥陀佛圣诞，又净宗二祖善导法师圆寂日",
            "1118": "地藏斋，又十斋日",
            "1119": "观音斋，太阳日宫诞，犯者得奇祸",
            "1121": "杨公忌",
            "1123": "张仙诞，犯者绝嗣，四天王巡行，又十斋日",
            "1124": "观音斋，又地藏斋，又十斋日",
            "1125": "掠刷大夫降，犯者遭大凶，月晦日，犯者减寿",
            "1126": "北方五道诞",
            "1127": "斗降，犯者夺纪，又若月小则本日为十斋日",
            "1128": "地藏斋，人神在阴，犯者得病，宜先一日即戒，又十斋日",
            "1129": "四天王巡行，又十斋日",
            "1130": "月晦，司命奏事，四天王巡行，犯者减寿，如月小，即戒廿九（每月同），又十斋日",
            "1201": "净宗四祖法照法师圆寂日，又地藏斋，又月朔，犯者夺纪，又十斋日",
            "1203": "斗降犯者夺纪",
            "1206": "天地仓开日，又雷斋日，犯者减寿",
            "1207": "掠刷大夫降，犯者得恶疾",
            "1208": "释迦牟尼佛成道，腊八节，又四天王巡行，初旬内戊日，亦名王侯腊，犯者夺纪，又十斋日",
            "1212": "太素三元君朝真",
            "1214": "四天王巡行，又十斋日",
            "1215": "月望，犯者夺纪，又四天王巡行，又十斋日",
            "1216": "南岳大帝诞",
            "1217": "净宗十二祖彻悟法师圆寂日",
            "1218": "地藏斋，又十斋日",
            "1219": "杨公忌",
            "1220": "天地交道，犯者促寿",
            "1221": "天猷上帝诞",
            "1223": "监斋菩萨圣诞，五岳诞降，又四天王巡行，又灶君节，又十斋日",
            "1224": "小年，地藏斋，又司命朝天奏人善恶，犯者得大祸，又十斋日",
            "1225": "观音斋，三清玉帝同降，考察善恶，犯者得奇祸，又月晦日，犯者减寿",
            "1227": "斗降，犯者夺纪，又若月小则本日为十斋日",
            "1228": "地藏斋，人神在阴，犯者得病，宜先一日即戒，又十斋日",
            "1229": "华严菩萨圣诞，又四天王巡行，又十斋日",
            "0100": "除夕，记得持斋诵戒！诸神下降，察访善恶，犯者男女俱亡，又十斋日"
        };

        var today = new Date();
        var currentYear = today.getFullYear();
        var currentMonth = today.getMonth();
        var currentDay = today.getDate();

        function lYearDays(y) {
            var i, sum = 348;
            for(i=0x8000; i>0x8; i>>=1) sum += (lunarInfo[y-1900] & i)? 1: 0;
            return sum + leapDays(y);
        }

        function leapDays(y) {
            if(leapMonth(y)) return (lunarInfo[y-1900] & 0x10000)? 30: 29;
            return 0;
        }

        function leapMonth(y) {
            return lunarInfo[y-1900] & 0xf;
        }

        function monthDays(y,m) {
            return (lunarInfo[y-1900] & (0x10000>>m))? 30: 29;
        }

        function Lunar(objDate) {
            var i, leap=0, temp=0;
            var baseDate = new Date(1900,0,31);
            var offset = (Date.UTC(objDate.getFullYear(),objDate.getMonth(),objDate.getDate()) - Date.UTC(1900,0,31))/86400000;

            this.dayCyl = offset + 40;
            this.monCyl = 14;

            for(i=1900; i<2050 && offset>0; i++) {
                temp = lYearDays(i);
                offset -= temp;
                this.monCyl += 12;
            }

            if(offset<0) {
                offset += temp;
                i--;
                this.monCyl -= 12;
            }

            this.year = i;
            this.yearCyl = i-1864;
            leap = leapMonth(i);
            this.isLeap = false;

            for(i=1; i<13 && offset>0; i++) {
                if(leap>0 && i==(leap+1) && this.isLeap==false) {
                    --i;
                    this.isLeap = true;
                    temp = leapDays(this.year);
                } else {
                    temp = monthDays(this.year, i);
                }

                if(this.isLeap==true && i==(leap+1)) this.isLeap = false;
                offset -= temp;
                if(this.isLeap == false) this.monCyl++;
            }

            if(offset==0 && leap>0 && i==leap+1) {
                if(this.isLeap) {
                    this.isLeap = false;
                } else {
                    this.isLeap = true;
                    --i;
                    --this.monCyl;
                }
            }

            if(offset<0) {
                offset += temp;
                --i;
                --this.monCyl;
            }

            this.month = i;
            this.day = offset + 1;
        }

        function solarDays(y,m) {
            if(m==1) return (((y%4 == 0) && (y%100 != 0) || (y%400 == 0))? 29: 28);
            return solarMonth[m];
        }

        function cyclical(num) {
            return Gan[num%10] + Zhi[num%12];
        }

        function cDay(d) {
            var s;
            switch (d) {
                case 10: s = '初十'; break;
                case 20: s = '二十'; break;
                case 30: s = '三十'; break;
                default:
                    s = nStr2[Math.floor(d/10)];
                    s += nStr1[d%10];
            }
            return s;
        }

        function sTerm(y,n) {
            var offDate = new Date((31556925974.7*(y-1900) + sTermInfo[n]*60000) + Date.UTC(1900,0,6,2,5));
            return offDate.getUTCDate();
        }

        function initSelects() {
            var yearSelect = document.getElementById('yearSelect');
            var monthSelect = document.getElementById('monthSelect');

            for(var i=1900; i<2050; i++) {
                var option = document.createElement('option');
                option.value = i;
                option.textContent = i;
                yearSelect.appendChild(option);
            }

            for(var i=1; i<=12; i++) {
                var option = document.createElement('option');
                option.value = i;
                option.textContent = i;
                monthSelect.appendChild(option);
            }

            yearSelect.value = currentYear;
            monthSelect.value = currentMonth + 1;

            yearSelect.addEventListener('change', drawCalendar);
            monthSelect.addEventListener('change', drawCalendar);
        }

        // 自动截取前 10 个字符，并在超出时自动添加“…”
        function truncateString(str, maxLength = 10) {
            if (str.length > maxLength) {
                return str.slice(0, maxLength) + '...';
            } else {
                return str;
            }
        }

        function drawCalendar() {
            var year = parseInt(document.getElementById('yearSelect').value);
            var month = parseInt(document.getElementById('monthSelect').value) - 1;

            var firstDay = new Date(year, month, 1);
            var lastDay = solarDays(year, month);
            var firstWeek = firstDay.getDay();

            var tbody = document.getElementById('calendarBody');
            tbody.innerHTML = '';

            var lunar = new Lunar(new Date(year, month, 15));
            var lunarYear = lunar.year;
            
            // 判断当月15日是否已经进入新的农历年
            var monthStartLunar = new Lunar(new Date(year, month, 1));
            var isNewLunarYear = (month === 0 && monthStartLunar.month > 10) || 
                                 (month === 1 && monthStartLunar.month > 10);
            
            // 如果公历1月或2月初，但农历还是上一年的腊月，则使用上一年
            if(isNewLunarYear) {
                lunarYear = lunarYear - 1;
            }
            
            var buddhYear = lunarYear + 544;
            var ganZhi = cyclical(lunarYear - 1900 + 36);
            var animal = Animals[(lunarYear - 4) % 12];

            document.getElementById('lunarInfo').innerHTML = 
                `佛历${buddhYear}年 农历${ganZhi}年【${animal}年】`;

            var day = 1;
            for(var i=0; i<6; i++) {
                var row = document.createElement('tr');
                
                for(var j=0; j<7; j++) {
                    var cell = document.createElement('td');
                    
                    if(i === 0 && j < firstWeek) {
                        cell.classList.add('empty-cell');
                        cell.innerHTML = '&nbsp;';
                    } else if(day > lastDay) {
                        cell.classList.add('empty-cell');
                        cell.innerHTML = '&nbsp;';
                    } else {
                        var date = new Date(year, month, day);
                        var lunarDate = new Lunar(date);
                        
                        var isToday = (year === currentYear && month === currentMonth && day === currentDay);
                        
                        if(isToday) {
                            cell.classList.add('today');
                        }
                        
                        if(j === 0 || j === 6) {
                            cell.classList.add(j === 0 ? 'sunday' : 'saturday');
                        }

                        var solarDayDiv = document.createElement('div');
                        solarDayDiv.className = 'solar-day';
                        solarDayDiv.textContent = day;

                        var lunarDayDiv = document.createElement('div');
                        lunarDayDiv.className = 'lunar-day';
                        if(lunarDate.day === 1) {
                            lunarDayDiv.textContent = (lunarDate.isLeap ? '闰' : '') + nStr3[lunarDate.month] + '月';
                        } else {
                            lunarDayDiv.textContent = cDay(lunarDate.day);
                        }

                        cell.appendChild(solarDayDiv);
                        cell.appendChild(lunarDayDiv);

                        var solarKey = String(month + 1).padStart(2, '0') + String(day).padStart(2, '0');
                        if(sFtv[solarKey]) {
                            var festival = document.createElement('div');
                            festival.className = 'festival solar-festival';
                            festival.textContent = sFtv[solarKey];
                            cell.appendChild(festival);
                        }

                        var lunarKey = String(lunarDate.month).padStart(2, '0') + String(lunarDate.day).padStart(2, '0');
                        if(lFtv[lunarKey]) {
                            // 只显示主要节日，不显示完整描述
                            var festivalText = lFtv[lunarKey];
                            var mainFestival = truncateString(festivalText);
                            
                            // 提取主要节日名称
                            /*
                            if(festivalText.includes('菩萨圣诞') || festivalText.includes('佛圣诞') || 
                               festivalText.includes('祖师圣诞') || festivalText.includes('如来圣诞')) {
                                var matches = festivalText.match(/[^，。]+?(?:菩萨|佛|祖师|如来)(?:圣诞|成道|出家|涅槃)/);
                                if(matches) mainFestival = matches[0];
                            } else if(festivalText.includes('春节') || festivalText.includes('元宵') || 
                                     festivalText.includes('端午') || festivalText.includes('中秋') ||
                                     festivalText.includes('重阳') || festivalText.includes('小年') ||
                                     festivalText.includes('除夕') || festivalText.includes('腊八')) {
                                var matches = festivalText.match(/春节|元宵节|端午节|中秋节|重阳节|小年|除夕|腊八节/);
                                if(matches) mainFestival = matches[0];
                            } else if(festivalText.includes('十斋日')) {
                                mainFestival = '十斋日';
                            } else if(festivalText.includes('佛欢喜日')) {
                                mainFestival = '佛欢喜日';
                            }
                            */
                            
                            if(mainFestival) {
                                var festival = document.createElement('div');
                                if(mainFestival === '十斋日') {
                                    festival.className = 'festival ten-fast-day';
                                } else {
                                    festival.className = 'festival lunar-festival';
                                }
                                festival.textContent = mainFestival;
                                cell.appendChild(festival);
                            }
                        }

                        var term1 = sTerm(year, month * 2);
                        var term2 = sTerm(year, month * 2 + 1);
                        if(day === term1 || day === term2) {
                            var termDiv = document.createElement('div');
                            termDiv.className = 'festival solar-term';
                            termDiv.textContent = day === term1 ? solarTerm[month * 2] : solarTerm[month * 2 + 1];
                            cell.appendChild(termDiv);
                        }

                        cell.dataset.year = year;
                        cell.dataset.month = month + 1;
                        cell.dataset.day = day;
                        cell.dataset.lunarYear = lunarDate.year;
                        cell.dataset.lunarMonth = lunarDate.month;
                        cell.dataset.lunarDay = lunarDate.day;
                        cell.dataset.isLeap = lunarDate.isLeap;
                        cell.dataset.ganZhi = cyclical(lunarDate.yearCyl) + '年 ' + 
                                              cyclical(lunarDate.monCyl) + '月 ' + 
                                              cyclical(lunarDate.dayCyl) + '日';

                        cell.addEventListener('mouseenter', showDetail);
                        cell.addEventListener('mouseleave', hideDetail);

                        day++;
                    }
                    
                    row.appendChild(cell);
                }
                
                tbody.appendChild(row);
                if(day > lastDay) break;
            }
        }

        function showDetail(e) {
            var cell = e.currentTarget;
            if(cell.classList.contains('empty-cell')) return;

            var popup = document.getElementById('detailPopup');
            var year = cell.dataset.year;
            var month = cell.dataset.month;
            var day = cell.dataset.day;
            var week = nStr1[new Date(year, month - 1, day).getDay()];
            
            var detailHTML = `
                <div class="detail-title">
                    ${year}年${month}月${day}日 星期${week}
                </div>
                <div class="detail-content">
                    <p style="color: #764ba2; font-weight: bold;">农历${cell.dataset.isLeap === 'true' ? '闰' : ''}${nStr3[cell.dataset.lunarMonth]}月${cDay(parseInt(cell.dataset.lunarDay))}</p>
                    <p style="color: #667eea;">${cell.dataset.ganZhi}</p>
            `;
            
            var solarKey = String(month).padStart(2, '0') + String(day).padStart(2, '0');
            var lunarKey = String(cell.dataset.lunarMonth).padStart(2, '0') + String(cell.dataset.lunarDay).padStart(2, '0');
            var termDay1 = sTerm(parseInt(year), (parseInt(month) - 1) * 2);
            var termDay2 = sTerm(parseInt(year), (parseInt(month) - 1) * 2 + 1);
            
            var hasFestival = false;
            if(sFtv[solarKey] || lFtv[lunarKey] || parseInt(day) === termDay1 || parseInt(day) === termDay2) {
                detailHTML += '<div class="detail-festivals">';
                hasFestival = true;
                
                if(sFtv[solarKey]) {
                    detailHTML += `<p class="solar-festival"><strong>阳历节日：</strong>${sFtv[solarKey]}</p>`;
                }
                
                if(lFtv[lunarKey]) {
                    detailHTML += `<p class="lunar-festival"><strong>农历节日：</strong>${lFtv[lunarKey]}</p>`;
                }
                
                if(parseInt(day) === termDay1) {
                    detailHTML += `<p class="solar-term"><strong>节气：</strong>${solarTerm[(parseInt(month) - 1) * 2]}</p>`;
                }
                if(parseInt(day) === termDay2) {
                    detailHTML += `<p class="solar-term"><strong>节气：</strong>${solarTerm[(parseInt(month) - 1) * 2 + 1]}</p>`;
                }
                
                detailHTML += '</div>';
            }
            
            detailHTML += '</div>';
            
            popup.innerHTML = detailHTML;
            popup.classList.add('show');
            
            // 在PC端保持原有定位逻辑
            if (window.innerWidth >= 768) {
                var rect = cell.getBoundingClientRect();
                var popupLeft = rect.left + rect.width / 2 - 150;
                
                // 防止弹窗超出屏幕左侧
                if(popupLeft < 10) popupLeft = 10;
                // 防止弹窗超出屏幕右侧
                if(popupLeft + 300 > window.innerWidth) {
                    popupLeft = window.innerWidth - 310;
                }
                
                popup.style.left = popupLeft + 'px';
                popup.style.top = rect.bottom + 10 + window.scrollY + 'px';
                popup.style.transform = 'none'; /* PC端取消居中 */
            } else {
                // 在移动端使用居中定位
                popup.style.left = '50%';
                popup.style.top = '50%';
                popup.style.transform = 'translate(-50%, -50%)'; /* 移动端居中 */
            }
        }

        function hideDetail() {
            var popup = document.getElementById('detailPopup');
            popup.classList.remove('show');
        }

        function changeMonth(delta) {
            var monthSelect = document.getElementById('monthSelect');
            var yearSelect = document.getElementById('yearSelect');
            
            var currentMonth = parseInt(monthSelect.value);
            var currentYear = parseInt(yearSelect.value);
            
            currentMonth += delta;
            
            if(currentMonth > 12) {
                currentMonth = 1;
                currentYear++;
            } else if(currentMonth < 1) {
                currentMonth = 12;
                currentYear--;
            }
            
            if(currentYear >= 1900 && currentYear < 2050) {
                yearSelect.value = currentYear;
                monthSelect.value = currentMonth;
                drawCalendar();
            }
        }

        function goToday() {
            document.getElementById('yearSelect').value = currentYear;
            document.getElementById('monthSelect').value = currentMonth + 1;
            drawCalendar();
        }

        initSelects();
        drawCalendar();
    </script>
</body>
</html>